# 缓存初探

# Springboot使用Redis缓存



# 缓存可能会出现的几个场景

## 缓存雪崩

缓存雪崩是指原缓存失效，新缓存未到达之前，所有请求都去请求数据库，从而给数据库带来巨大的压力。

处理方法：

1、并发不大的时候，可以使用加锁排队

2、给每一个缓存的数据添加相应的缓存标记，记录缓存是否失效，如果缓存失效，则更新缓存。

3、为key设置不同的缓存时间，这样可以减少同时请求的概率。

## 缓存穿透

缓存穿透是指用户查询数据，在数据库中不存在，自然在缓存中也不存在。这样就导致用户查询的时候，在缓存中找不到，每次都要去数据库再查询一遍，然后返回空（相当于进行了两次无用的查询）。这样请求就绕过缓存直接查数据库，这也是经常提的缓存命中率问题。

处理方法：

1、使用布隆过滤器，将可能存在的数据存到一个足够大的bitmap中，一个一定不存在的数据会被这个 bitmap 拦截掉，从而避免了对底层存储系统的查询压力。

2、假如查询的数据返回为空（不管是数据不存在还是系统故障）我们仍然把这个空结果进行缓存，但它的过期时间会很短，最长不超过五分钟。通过这个直接设置的默认值存放到缓存，这样第二次到缓冲中获取就有值了，而不会继续访问数据库

## 缓存预热

缓存预热就是系统上线后，将相关的缓存数据直接加载到缓存系统。这样就可以避免在用户请求的时候， 先查询数据库，然后再将数据缓存的问题!用户直接查询事先被预热的缓存数据。

## 缓存更新

除了缓存服务器自带的缓存策略之外，还可以在具体的代码中设置缓存的更新

1、定时清理过去的缓存

2、当有用户请求过来时，判断缓存是否过期，过期的话就去底层系统得到新数据并更新缓存。

## 缓存降级

当访问量剧增、服务出现问题(如响应时间慢或不响应)或非核心服务影响到核心流程的性能时，仍然需要保证服务还是可用的，即使是有损服务。系统可以根据一些关键数据进行自动降级，也可以配置开关实现人工降级。降级的最终目的是保证核心服务可用，即使是有损的。而且有些服务是无法降级的(如加入购物车、结算)。

